<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Go LightStream Test</title>
</head>
<body>
  <h2>Go LightStream WebSocket Test</h2>
  <label>
    Room ID:
    <input id="roomID" placeholder="e.g. room1">
  </label>
  <br><br>
  <button onclick="connect()">Connect</button>
  <button onclick="disconnect()">Disconnect</button>
  <br><br>
  <textarea id="log" rows="10" cols="50" readonly></textarea>
  <br><br>
  <input id="msgInput" placeholder="Type your message">
  <button onclick="sendMessage()">Send</button>

  <script>
    let socket;

    function logMessage(message) {
      const log = document.getElementById("log");
      log.value += message + "\n";
      log.scrollTop = log.scrollHeight;
    }

    function connect() {
      const roomID = document.getElementById("roomID").value;
      if (!roomID) {
        alert("Please enter a room ID");
        return;
      }

      const url = `ws://localhost:8080/ws?room=${roomID}`;
      socket = new WebSocket(url);

      socket.onopen = () => {
        logMessage("[Connected]");
      };

      socket.onmessage = (event) => {
        logMessage("[Received] " + event.data);
      };

      socket.onclose = () => {
        logMessage("[Disconnected]");
      };

      socket.onerror = (error) => {
        logMessage("[Error] " + error.message);
      };
    }

    function disconnect() {
      if (socket) {
        socket.close();
        socket = null;
      }
    }

    function sendMessage() {
      const msg = document.getElementById("msgInput").value;
      if (socket && socket.readyState === WebSocket.OPEN) {
        socket.send(msg);
        logMessage("[Sent] " + msg);
        document.getElementById("msgInput").value = "";
      } else {
        alert("Socket is not connected.");
      }
    }
  </script>
</body>
</html>
